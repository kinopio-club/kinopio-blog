<html lang="en"><head><title>Card Dragging Performance Up</title><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="description" content="Significantly improved smoothness of card dragging"/><meta name="og:title" content="Card Dragging Performance Up"/><meta name="og:description" content="Significantly improved smoothness of card dragging"/><meta name="og:image" content="https://kinopio-blog.us-east-1.linodeobjects.com/please-wait.webp"/><meta name="og:type" content="article"/><link rel="stylesheet" href="/styles/styles.css"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="alternate" type="application/rss+json" href="/feed.json"/></head><body style="background-color:undefined"><div class="content-wrap"><header><div class="title"><a href="/"><img class="hidden" src="/assets/logo-hover.png"/><img class="hidden" src="/assets/logo-active.png"/><div class="logo"></div><h1>Kinopio Blog</h1></a></div></header><nav><a href="https://kinopio.club"><button class="button-to-kinopio">Open Kinopio</button></a></nav><main><article><h1>Card Dragging Performance Up</h1><img class="icon updated" src="/assets/updated.gif"/><a href="/"><p class="post-meta post-tag">New Stuff</p></a><a href="/posts/card-dragging-performance-up/"><span class="post-meta">Nov 22, 2023</span></a><div class="article-content"><hr/><span><p>In a complex space, moving cards could skip frames and go out of sync with the connection lines. Today's release significantly improves the speed and smoothness of card dragging.</p>
<p>
<video class="wide" autoplay loop muted playsinline>
  <source src="https://updates.kinopio.club/card-drag-perf.mp4">
</video>
</p>
<h2>Technical Details</h2>
<p>For those who asked how this was done:</p>
<p>You never know when ideas will come to you, so when they do I collect ideas for optimizations that come to me in <a href="https://kinopio.club/performance-improvement-ideas-7TppdPf1lcjTV89Kwyw4Y">this space</a>. This performance improvement was one of those.</p>
<p>As you may know, the <a href="https://pketh.org/how-kinopio-is-made.html">kinopio-client</a> app that runs in your browser uses Vue.js to manage and update state.</p>
<p>The <code>x,y</code> position of cards in the currentSpace is tracked in state so that when card positions change, the computed methods in many other components that depend on the position of cards can automatically recompute themselves. (aka <code>data-binding</code>)</p>
<p>But the magic of data-binding becomes a liability when an item is updating it's state 60 times a second (<code>60fps</code>) – such as when you drag a card around the screen. And if 10 cards are being dragged together, that's 60 × 10 updates a second.</p>
<p>As you might imagine, all this dependency recomputing and repainting can overwhelm the browser causing frame rate hitches.</p>
<p>The way to get around this issue is to just not update state during these kinds of events. So while a card is being dragged, it's position is directly manipulated in the DOM in a very lo-fi way:</p>
<pre><code>moveWhileDragging: (state, { cards }) =&gt; {
    cards.forEach(card =&gt; {
        const element = document.querySelector(`article[data-card-id=&quot;${card.id}&quot;]`)
        element.style.left = card.x + 'px'
        element.style.top = card.y + 'px'
    })
},
</code></pre>
<p>And only after the drag is complete is the Vue state updated with the new card positions. Which means that all that expensive data-bound recomputing only needs to happen only once at the end.</p>
</span></div></article><script src="/assets/js/post.js"></script></main><footer id="footer"><img class="froggo" src="/assets/froggo.png"/><div class="button-wrap"><a href="/feed.json"><button>RSS</button></a></div><div class="button-wrap"><a href="https://twitter.com/KinopioClub"><button>Follow @KinopioClub</button></a></div><div class="button-wrap"><a href="https://kinopio.club"><button class="button-to-kinopio">Kinopio →</button></a></div><div class="sections"><section><h3>Contact Support</h3><ul><li><a href="mailto:hi@kinopio.club"><span class="extended-text">Mail&nbsp;</span><span>hi@kinopio.club</span></a></li><li><a href="https://club.kinopio.club">Support Forum</a></li><li><a href="https://discord.gg/h2sR45Nby8">Discord</a></li></ul></section><section><h3>Spread the word</h3><ul><li><a href="https://www.producthunt.com/posts/kinopio"><span class="extended-text">Featured on&nbsp;</span><span>ProductHunt</span></a></li><li><a href="https://alternativeto.net/software/kinopio/about"><span class="extended-text">Like on&nbsp;</span><span>AlternativeTo</span></a></li><li><a href="https://www.saashub.com/kinopio"><span class="extended-text">Review on&nbsp;</span><span>Saashub</span></a></li></ul></section></div></footer></div><!-- p--><!--   a(href="https://github.com/kinopio-club/kinopio-help") View Source--><canvas id="background"></canvas><canvas id="page-background"></canvas><canvas class="auto-paint" id="canvas-intro"></canvas><canvas class="auto-paint" id="canvas-collaboration"></canvas><canvas class="auto-paint" id="canvas-images"></canvas><canvas class="auto-paint" id="canvas-tags"></canvas><canvas class="auto-paint" id="canvas-comments"></canvas><canvas class="auto-paint" id="canvas-mobile-left"></canvas><canvas class="auto-paint" id="canvas-mobile-right"></canvas><canvas class="auto-paint" id="canvas-cta-bottom"></canvas></body><script src="/assets/js/magic-paint.js"></script></html>